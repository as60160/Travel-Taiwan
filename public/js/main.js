"use strict";console.clear();var type={attraction:["自然風景類","體育健身類","遊憩類","古蹟類","其他"],activity:["年度活動","藝文活動","節慶活動","其他"]},allCityData=[],allAttractionData=[],allActivityData=[],attractionData=[],activityData=[],selectedType="all",selectedCity="all",currentPath="index",startNum=0,stepNum=12,selectedPage=1,totalPages=1,typeSelect=document.getElementById("type"),citySelect=document.getElementById("city"),searchBtn=document.getElementById("searchBtn"),backToTopBtn=document.getElementById("backToTopBtn"),cardList=document.getElementById("cardList"),pagination=document.getElementById("pagination");function init(){resetPagination(),detectPath(),getCityData()}function detectPath(){currentPath=location.pathname,document.querySelector("[data-path]").classList.remove("active"),currentPath.includes("/index.html")&&(changeNavClass("index"),changeBannerPicture("index"),renderTypes(type.attraction),getAttractionSpot(),getActivityData(),searchBtn.href="attractions.html"),currentPath.includes("/attractions.html")?(changeNavClass("attractions"),changeBannerPicture("attractions"),renderTypes(type.attraction),getAttractionSpot(),searchBtn.href="attractions.html"):currentPath.includes("/activities.html")&&(changeNavClass("activities"),changeBannerPicture("activities"),renderTypes(type.activity),getActivityData(),searchBtn.href="activities.html")}function changeNavClass(t){document.querySelector("[data-path=".concat(t,"]")).classList.add("active")}function changeBannerPicture(t){document.querySelector("#banner").classList.add("bg-".concat(t))}function searchData(){currentPath.includes("/index.html")&&(localStorage.setItem("type",selectedType),localStorage.setItem("city",selectedCity),location.pathname="/Travel-Taiwan/public/attractions.html"),currentPath.includes("/activities.html")?filterData(activityData):filterData(attractionData)}function scrollFunction(){500<document.body.scrollTop||500<document.documentElement.scrollTop?backToTopBtn.style.display="block":backToTopBtn.style.display="none"}function topFunction(){var t=document.documentElement,a=document.body,e=setInterval(function(){t.scrollTop-=Math.ceil(.1*t.scrollTop),a.scrollTop-=Math.ceil(.1*a.scrollTop),0==t.scrollTop&&clearInterval(e)},20)}function getCityData(){axios({method:"get",url:"assets/city-name.json",Headers:GetAuthorizationHeader()}).then(function(t){renderCityName(allCityData=t.data.data)}).catch(function(t){console.log("縣市",t)})}function getAttractionSpot(){axios({method:"get",url:"https://ptx.transportdata.tw/MOTC/v2/Tourism/ScenicSpot?$format=JSON",Headers:GetAuthorizationHeader()}).then(function(t){t.data.forEach(function(t){t.Class1&&t.Address&&allAttractionData.push(t)}),processingData(allAttractionData)}).catch(function(t){console.log(t)})}function getActivityData(){axios({method:"get",url:"https://ptx.transportdata.tw/MOTC/v2/Tourism/Activity?$format=JSON",Headers:GetAuthorizationHeader()}).then(function(t){t.data.forEach(function(t){(t.Class1||t.Class2)&&t.Address&&(t.Name.includes("取消")||allActivityData.push(t))}),processingData(allActivityData)}).catch(function(t){console.log(t)})}function processingData(n){attractionData=[],activityData=[],n.forEach(function(t){var a="無提供資料",e={};e.id=t.ID,e.name=t.Name,e.address=t.Address,e.description=t.Description?t.Description:a,e.ticketInfo=t.TicketInfo?t.TicketInfo:a,e.phone=t.Phone?t.Phone:a,e.class=t.Class1,t.Picture.PictureUrl1?(e.imgSrc=t.Picture.PictureUrl1,e.imgDes=t.Picture.PictureDescription1):(e.imgSrc="https://fakeimg.pl/500x300/?text=No%20image",e.imgDes="無提供圖片"),n==allAttractionData&&(t.OpenTime?t.OpenTime.includes("24 hours")?e.time="全天候開放":e.time=t.OpenTime:e.time=a,attractionData.push(e)),n==allActivityData&&(e.time=t.StartTime?t.StartTime.slice(0,10):a,activityData.push(e))}),n==allAttractionData&&filterData(attractionData),n==allActivityData&&filterData(activityData)}function filterData(t){localStorage.getItem("type")&&localStorage.getItem("city")&&(selectedType=localStorage.getItem("type"),selectedCity=localStorage.getItem("city"),localStorage.clear());var a=[];"all"!=selectedCity&&"all"!=selectedType?t.forEach(function(t){t.address.includes(selectedCity)&&t.class==selectedType&&a.push(t)}):a="all"!=selectedCity&&"all"==selectedType?t.filter(function(t){return t.address.includes(selectedCity)}):"all"==selectedCity&&"all"!=selectedType?t.filter(function(t){return t.class==selectedType}):t,renderData(a)}function splitString(t,a){return t.length>=a?t.slice(0,a)+"...":t}function renderTypes(t){var a='<option value="all">所有類別</option>';t.forEach(function(t){a+='<option value="'.concat(t,'">').concat(t,"</option>")}),typeSelect.innerHTML=a}function renderCityName(t){var a='<option value="all">所有縣市</option>';t.forEach(function(t){a+='<option value="'.concat(t.cityName,'">').concat(t.cityName,"</option>")}),citySelect.innerHTML=a}function renderData(a){currentPath.includes("/index.html")&&(startNum=Math.floor(Math.random()*a.length-stepNum));var t=startNum+stepNum,e="";if(0==a.length)e+='\n      <li class="text-center mb-12 mb-md-8 px-1">\n        <p>抱歉，搜尋不到您想要的資料  ಥ⌣ಥ</p>\n      </li>\n    ';else for(var n=startNum;n<t&&null!=a[n];n++){var c=splitString(a[n].name,9),i=splitString(a[n].address,9),l=splitString(a[n].time,11);e+='\n        <li class="col-3 col-lg-4 col-md-6 col-sm-12 mb-12 mb-md-8 px-1">\n          <div class="card">\n            <div class="card__head">\n              <img class="card__img" src="'.concat(a[n].imgSrc,'" alt="').concat(a[n].imgDes,'"/>\n            </div>\n            <div class="card__body"> \n              <h3 class="mt-6 mb-2">').concat(c,'</h3>\n              <p class="mb-2">\n                <img class="icon" src="img/geo.svg" alt="geo"/>\n                <span class="ml-1">').concat(i,'</span>\n              </p>\n              <p class="mb-2">\n                <img class="icon icon-sm" src="img/clock.svg" alt="clock"/>\n                <span class="ml-1">').concat(l,'</span>\n              </p>\n            </div>\n            <div class="card__footer pb-4">\n              <a class="card__btn" href="#" data-modal-target=').concat(a[n].id,">了解更多 </a>\n            </div>\n          </div>\n        </li>\n      ")}var s="all"==selectedCity?"熱門":selectedCity,o=currentPath.includes("/attractions.html")?"景點":"活動";cardList.innerHTML='\n    <div class="info pl-1"> \n      <h2 class="title-primary mb-4">'.concat(s).concat(o,'</h2>\n      <p>台灣的各個美景，都美不勝收。</p>\n      <p class="mb-8">等你一同來發現這座寶島的奧妙！</p>\n    </div>\n    <ul class="d-flex flex-wrap"> ').concat(e," </ul>\n  "),pagination&&renderPagination(a.length),document.querySelectorAll("[data-modal-target]").forEach(function(t){t.addEventListener("click",function(t){t.preventDefault(),openModal(t,a)})})}function renderPagination(t){pagination.style.display=t?"flex":"none";var a='<li><a href="#" data-minus="1">&lt;</a></li>';if((totalPages=Math.ceil(t/stepNum))<5)for(var e=1;e<=totalPages;e++)a+='<li><a href="#" data-num='.concat(e,">").concat(e,"</a></li>");else if(selectedPage<=3){for(var n=1;n<=5;n++)a+='<li><a href="#" data-num='.concat(n,">").concat(n,"</a></li>");a+='<li><a href="#" data-add="2">...</a></li>'}else if(totalPages-2<=selectedPage){a+='<li><a href="#" data-minus="2">...</a></li>';for(var c=selectedPage-2;c<=totalPages;c++)a+='<li><a href="#" data-num='.concat(c,">").concat(c,"</a></li>")}else{a+='<li><a href="#" data-minus="2">...</a></li>';for(var i=selectedPage-2;i<=selectedPage+2;i++)a+='<li><a href="#" data-num='.concat(i,">").concat(i,"</a></li>");a+='<li><a href="#" data-add="2">...</a></li>'}a+='<li><a href="#" data-add="1">&gt;</a></li>',pagination.innerHTML=a,document.querySelector("[data-num='".concat(selectedPage,"']")).classList.add("active")}function changeSelectedPage(t){if("A"==t.target.nodeName){var a=Number(t.target.dataset.num),e=Number(t.target.dataset.add),n=Number(t.target.dataset.minus);a?selectedPage=a:n&&1<selectedPage?selectedPage-=n:e&&selectedPage<totalPages&&(selectedPage+=e),startNum=(selectedPage-1)*stepNum,currentPath.includes("/attractions.html")?filterData(attractionData):filterData(activityData)}}function resetPagination(){startNum=0,selectedPage=1}function openModal(t,a){var e=t.target.dataset.modalTarget,n=a.findIndex(function(t){return t.id==e}),c=a[n],i=document.querySelector("#modal");i.classList.add("active"),i.innerHTML='\n    <div class="modal__content col-6 col-lg-8 col-md-10">\n      <div class="modal__header">\n        <a id="closeBtn" href="#" data-close-button> </a>\n      </div>\n      <div class="modal__body"> \n        <h2 class="mb-4">'.concat(c.name,'</h2>\n        <p class="mb-4 d-flex align-items-center">\n          <img class="icon" src="img/geo.svg" alt="">\n          <span class="fs-5">').concat(c.address,'</span>\n        </p>\n        <p class="mb-8">').concat(c.description,'</p>\n        <img class="mb-8" src="').concat(c.imgSrc,'" alt="').concat(c.imgDes,'">\n      </div>\n      <div class="modal__footer">\n        <ul class="text-primary d-flex">\n          <li class="mb-1">\n            <img class="icon" src="img/clock.svg" alt="">\n            <span>').concat(c.time,'</span>\n          </li>\n          <li class="mb-1">\n            <img class="icon" src="img/ticket.svg" alt="">\n            <span>').concat(c.ticketInfo,'</span>\n          </li>\n          <li class="mb-1">\n            <img class="icon" src="img/phone.svg" alt="">\n            <span>').concat(c.phone,'</span>\n          </li>\n          <li class="mb-1">\n            <img class="icon" src="img/list.svg" alt="">\n            <span>').concat(c.class,"</span>\n          </li>\n        </ul>\n      </div>\n    </div>\n  "),i.addEventListener("click",function(t){t.preventDefault(),"A"===t.target.nodeName&&i.classList.remove("active")})}function GetAuthorizationHeader(){var t=(new Date).toGMTString(),a=new jsSHA("SHA-1","TEXT");return a.setHMACKey("FFFFFFFF-FFFF-FFFF-FFFF-FFFFFFFFFFFF","TEXT"),a.update("x-date: "+t),{Authorization:'hmac username="FFFFFFFF-FFFF-FFFF-FFFF-FFFFFFFFFFFF", algorithm="hmac-sha1", headers="x-date", signature="'+a.getHMAC("B64")+'"',"X-Date":t}}typeSelect.addEventListener("change",function(t){return selectedType=t.target.value}),citySelect.addEventListener("change",function(t){return selectedCity=t.target.value}),searchBtn.addEventListener("click",function(t){t.preventDefault(),searchData(),resetPagination()}),backToTopBtn.addEventListener("click",function(t){t.preventDefault(),topFunction()}),init(),window.onscroll=function(){scrollFunction()},pagination.addEventListener("click",function(t){t.preventDefault(),changeSelectedPage(t)});